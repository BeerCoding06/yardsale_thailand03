services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.prod
    ports:
      - "8000:80"

    labels:
      # Traefik Configuration
      - "traefik.enable=true"
      # Route for nuxt domain
      - "traefik.http.routers.app.rule=Host(`yardsalethailand-nuxt-8p0ykj-f4d600-157-85-98-150.traefik.me`)"
      - "traefik.http.routers.app.entrypoints=web"
      - "traefik.http.services.app.loadbalancer.server.port=80"
      # Route for wp domain (same service)
      - "traefik.http.routers.app-wp.rule=Host(`yardsalethailand-wp-8txv8a-1ef772-157-85-98-150.traefik.me`)"
      - "traefik.http.routers.app-wp.entrypoints=web"
      - "traefik.http.routers.app-wp.service=app"
      # Note: We don't strip /wordpress prefix because nginx expects it

    environment:
      # =================
      # Database (Docker Network)
      # =================
      - DB_HOST=mysql
      - DB_NAME=nuxtcommerce_db
      - DB_USER=root
      - DB_PASSWORD=RootBeer06032534

      # =================
      # Public URL (Traefik)
      # =================
      - BASE_URL=http://yardsalethailand-nuxt-8p0ykj-f4d600-157-85-98-150.traefik.me
      - WP_HOME=http://yardsalethailand-nuxt-8p0ykj-f4d600-157-85-98-150.traefik.me
      - WP_SITEURL=http://yardsalethailand-nuxt-8p0ykj-f4d600-157-85-98-150.traefik.me/wordpress
      - WP_MEDIA_HOST=http://yardsalethailand-nuxt-8p0ykj-f4d600-157-85-98-150.traefik.me/wordpress

      # =================
      # Internal
      # =================
      - INTERNAL_BASE_URL=http://app

      # =================
      # Auth / API
      # =================
      - WP_BASIC_AUTH=cGFyYWRvbl9wb2twaW5nbWF1bmc6eDRkTCA4QUp1IHQzSHkgZzIyMyA5aTViIG9hTnk=
      - WC_CONSUMER_KEY=ck_6c8520b64c0bac82b407b08e7de3c7908af0de51
      - WC_CONSUMER_SECRET=cs_fdcba105736b44ef72f787faeb0f3aec5e74306f
      - GQL_HOST=http://app/wordpress/graphql

    volumes:
      # Mount project root (WordPress files are now at root level)
      - .:/app
